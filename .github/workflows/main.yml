# name: Docker Image CI

# on:
#   push:
#     branches: [ main ]
#   pull_request:
#     branches: [ main ]

# jobs:

#   build:

#     runs-on: python:3.8-slim-buster


#     steps:
#     - uses: actions/checkout@v2
#       with:
#         lfs: 'true'
#     - 
#       name: Build the Docker image
#       run: docker build -t riva -f Dockerfile .
#     -
#       name: Generate Deployment Package
#       run: zip -r riva_deploy.zip *
#     -
#       name: Get timestamp
#       uses: gerred/actions/current-time@master
#       id: current-time
        
#     - name: Run string replace
#       uses: frabert/replace-string-action@master
#       id: format-time
#       with:
#         pattern: '[:\.]+'
#         string: "${{ steps.current-time.outputs.time }}"
#         replace-with: '-'
#         flags: 'g'

#     - name: Deploy to EC2
#       uses: easingthemes/ssh-deploy@main
#       with:
#         # aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
#         # aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#         application_name: riva
#          # environment_name: Birdsclassifierapi-env
#         # version_label: "birds-classifier-api-${{ steps.format-time.outputs.replaced }}"
#         region: us-east-2
#         deployment_package: riva_deploy.zip
#        env:
#           SSH_PRIVATE_KEY: ${{ secrets.SSH_KEY }}
#           REMOTE_HOST: ${{ secrets.REMOTE_HOST }}
#           REMOTE_USER: ${{ secrets.REMOTE_USER }}
          
          
          
name: deploy

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: EC2
    steps:
    - uses: actions/checkout@v2
    - name: Build and Run Docker
      run: docker build -t riva . && docker run -dp 8081:8081 riva

      
       
